# Fix Admin Dashboard Data Loading Issues

## Problems

From user's screenshots:

1. ❌ **Payments page empty** - "Chưa có dữ liệu thanh toán"
2. ❌ **Cannot add news** - Form shows "Tìm thấy liệu để hoặc mô tả" error
3. ❌ **Only 1 order showing** - Dashboard shows only 1 order instead of all orders
4. ❌ **Data appears lost** - User thinks data is deleted when server restarts

![Empty payments](file:///C:/Users/HPPAVILION/.gemini/antigravity/brain/67761a3f-f167-4439-b50e-525350ca8ee1/uploaded_image_0_1765196827623.png)

![News error](file:///C:/Users/HPPAVILION/.gemini/antigravity/brain/67761a3f-f167-4439-b50e-525350ca8ee1/uploaded_image_1_1765196827623.png)

![Only 1 order](file:///C:/Users/HPPAVILION/.gemini/antigravity/brain/67761a3f-f167-4439-b50e-525350ca8ee1/uploaded_image_2_1765196827623.png)

## Root Cause

### Backend Status ✅
- Backend server IS running (confirmed from terminal screenshot)
- MySQL connected successfully
- API endpoints exist and working

### Frontend Issues ❌

In [AdminDashboardPage.jsx](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/pages/Admin/AdminDashboardPage.jsx):

**Currently loading from API:**
- ✅ Payments (lines 72-105) - Loads when switching to 'payments' tab
- ✅ Users (lines 79-81) - Loads when switching to 'accounts' tab

**NOT loading from API:**
- ❌ Orders - Only uses data from `orderStore`, never calls [loadFromAPI()](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/stores/reviewStore.js#12-28)
- ❌ News - Only uses data from `newsStore`, never calls [loadFromAPI()](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/stores/reviewStore.js#12-28)
- ❌ Products - Only uses data from `productStore`, never calls [loadFromAPI()](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/stores/reviewStore.js#12-28)

**Result:**
- Dashboard shows stale data from localStorage
- When localStorage is cleared or empty, shows no data or only partial data
- Database has all the data, but frontend never fetches it

## Proposed Changes

### [AdminDashboardPage.jsx](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/pages/Admin/AdminDashboardPage.jsx)

#### 1. Import loadFromAPI functions

Add to imports section (around lines 1-10):

```javascript
const loadOrders = useOrderStore((s) => s.loadFromAPI)
const loadNews = useNewsStore((s) => s.loadFromAPI)
const loadProducts = useProductStore((s) => s.loadFromAPI)
```

#### 2. Update useEffect to load all data

Modify the existing useEffect (lines 73-82) to load orders, news, and products:

```javascript
useEffect(() => {
  if (tab === 'payments') {
    setPayments([])
    loadPayments()
  }
  if (tab === 'accounts') {
    loadUsers()
  }
  if (tab === 'revenue' || tab === 'orders') {
    loadOrders() // Load orders for revenue stats and order management
  }
  if (tab === 'news') {
    loadNews() // Load news when viewing news tab
  }
  if (tab === 'menu') {
    loadProducts() // Load products when viewing menu tab
  }
}, [tab, loadPayments, loadUsers, loadOrders, loadNews, loadProducts])
```

**OR** load everything on mount:

```javascript
// Load all data on mount
useEffect(() => {
  loadOrders()
  loadNews()
  loadProducts()
}, [loadOrders, loadNews, loadProducts])

// Keep existing tab-specific loading
useEffect(() => {
  if (tab === 'payments') {
    setPayments([])
    loadPayments()
  }
  if (tab === 'accounts') {
    loadUsers()
  }
}, [tab])
```

## Why This Fixes The Issues

### 1. Empty Payments
- Payments ARE being loaded from API (code exists)
- If still empty, means no payment records in database
- User needs to create orders with payments to see data

### 2. Cannot Add News  
- After adding `loadNews()`, news list will load from database
- Form validation looks correct (only requires `title`)
- Error message "Tìm thấy liệu để hoặc mô tả" might be from backend validation
- Need to check backend news controller

### 3. Only 1 Order
- After adding `loadOrders()`, all orders will load from database
- Currently only shows 1 order because localStorage only has 1 order
- Database likely has more orders

### 4. Data "Lost" on Restart
- Data is NOT lost - it's in MySQL database
- Problem is frontend not loading from database
- After fix, data will load from database every time

## Verification Plan

### Step 1: Implement Changes

Add the three [loadFromAPI](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/stores/reviewStore.js#12-28) calls to AdminDashboardPage

### Step 2: Clear localStorage

```javascript
// In browser console
localStorage.clear()
```

### Step 3: Test Each Tab

1. **Revenue tab**: Should show all orders and statistics
2. **Orders tab**: Should show all orders
3. **Menu tab**: Should show all products
4. **News tab**: Should show all news items
5. **Payments tab**: Should show all payment records
6. **Accounts tab**: Should show all users

### Step 4: Test News Creation

1. Fill in title, image, and description
2. Click "Thêm" button
3. Verify news appears in list
4. Refresh page
5. Verify news still appears (loaded from database)

### Step 5: Test Data Persistence

1. Create test data (order, news, product)
2. Refresh browser
3. Verify all data still appears
4. Restart backend server (Ctrl+C then `npm start`)
5. Refresh frontend
6. Verify all data still appears

## Expected Results

After fixes:
- ✅ All orders load from database and display correctly
- ✅ All news items load from database
- ✅ All products load from database
- ✅ Dashboard shows accurate statistics
- ✅ Data persists across page refreshes
- ✅ Data persists across server restarts
- ✅ No more "data lost" issues
