# üöÄ H∆∞·ªõng D·∫´n Chi Ti·∫øt: Qu√° Tr√¨nh Ch·∫°y Frontend

## üìã M·ª•c L·ª•c
1. [T·ªïng Quan Ki·∫øn Tr√∫c](#t·ªïng-quan-ki·∫øn-tr√∫c)
2. [Quy Tr√¨nh Kh·ªüi ƒê·ªông](#quy-tr√¨nh-kh·ªüi-ƒë·ªông)
3. [Lu·ªìng X·ª≠ L√Ω ·ª®ng D·ª•ng](#lu·ªìng-x·ª≠-l√Ω-·ª©ng-d·ª•ng)
4. [C·∫•u Tr√∫c Th∆∞ M·ª•c](#c·∫•u-tr√∫c-th∆∞-m·ª•c)
5. [C√°c Th√†nh Ph·∫ßn Ch√≠nh](#c√°c-th√†nh-ph·∫ßn-ch√≠nh)

---

## üèóÔ∏è T·ªïng Quan Ki·∫øn Tr√∫c

D·ª± √°n frontend c·ªßa b·∫°n s·ª≠ d·ª•ng **React + Vite**, m·ªôt stack hi·ªán ƒë·∫°i v√† nhanh ch√≥ng:

### C√¥ng Ngh·ªá S·ª≠ D·ª•ng:
- **React 18.3.1**: Th∆∞ vi·ªán UI component-based
- **Vite 5.4.6**: Build tool c·ª±c nhanh, thay th·∫ø Create React App
- **React Router DOM**: Qu·∫£n l√Ω routing/navigation
- **Zustand**: State management ƒë∆°n gi·∫£n, nh·∫π
- **Axios**: HTTP client ƒë·ªÉ g·ªçi API
- **React Icons**: Th∆∞ vi·ªán icon

---

## üîÑ Quy Tr√¨nh Kh·ªüi ƒê·ªông

### B∆∞·ªõc 1: Ch·∫°y L·ªánh `npm run dev`

Khi b·∫°n ch·∫°y l·ªánh n√†y, ƒëi·ªÅu g√¨ x·∫£y ra?

```bash
npm run dev
```

**Vite** s·∫Ω:
1. ‚úÖ ƒê·ªçc file c·∫•u h√¨nh [vite.config.js](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/vite.config.js)
2. ‚úÖ Kh·ªüi ƒë·ªông dev server t·∫°i `http://localhost:5173`
3. ‚úÖ Thi·∫øt l·∫≠p proxy ƒë·ªÉ forward c√°c request `/api/*` ƒë·∫øn backend `http://localhost:5000`
4. ‚úÖ B·∫≠t Hot Module Replacement (HMR) - t·ª± ƒë·ªông reload khi code thay ƒë·ªïi

### B∆∞·ªõc 2: Tr√¨nh Duy·ªát Load [index.html](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/index.html)

File [index.html](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/index.html) l√† ƒëi·ªÉm kh·ªüi ƒë·∫ßu:

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>my-app</title>
  </head>
  <body>
    <div id="root"></div>                    <!-- ‚≠ê React s·∫Ω render v√†o ƒë√¢y -->
    <script type="module" src="/src/main.jsx"></script>  <!-- ‚≠ê Entry point -->
  </body>
</html>
```

**ƒêi·ªÉm quan tr·ªçng:**
- `<div id="root"></div>`: Container r·ªóng, React s·∫Ω "chi·∫øm quy·ªÅn" v√† render to√†n b·ªô app v√†o ƒë√¢y
- `<script type="module" src="/src/main.jsx">`: Load file JavaScript ch√≠nh

### B∆∞·ªõc 3: Th·ª±c Thi [main.jsx](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/main.jsx)

File [main.jsx](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/main.jsx) kh·ªüi t·∫°o React app:

```jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App.jsx';
import './styles.css';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);
```

**Gi·∫£i th√≠ch t·ª´ng d√≤ng:**

| D√≤ng Code | Ch·ª©c NƒÉng |
|-----------|-----------|
| `ReactDOM.createRoot(...)` | T·∫°o React root t·∫°i `<div id="root">` |
| `<React.StrictMode>` | B·∫≠t ch·∫ø ƒë·ªô ki·ªÉm tra nghi√™m ng·∫∑t (ph√°t hi·ªán l·ªói ti·ªÅm ·∫©n) |
| `<BrowserRouter>` | B·∫≠t routing cho ·ª©ng d·ª•ng (qu·∫£n l√Ω URL) |
| `<App />` | Component ch√≠nh c·ªßa ·ª©ng d·ª•ng |
| `import './styles.css'` | Load CSS to√†n c·ª•c |

### B∆∞·ªõc 4: Component [App.jsx](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/App.jsx) ƒê∆∞·ª£c Render

File [App.jsx](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/App.jsx) l√† tr√°i tim c·ªßa ·ª©ng d·ª•ng:

```jsx
export default function App() {
  const role = useAuthStore(s => s.role);
  const verifyToken = useAuthStore(s => s.verifyToken);
  const toast = useNotifyStore();
  const location = useLocation();
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [isVerifying, setIsVerifying] = useState(true);
  
  // 1Ô∏è‚É£ Ki·ªÉm tra authentication khi app kh·ªüi ƒë·ªông
  useEffect(() => {
    const checkAuth = async () => {
      try {
        await verifyToken();  // G·ªçi API ki·ªÉm tra token
      } catch (error) {
        console.error('Auth verification error:', error);
      } finally {
        setIsVerifying(false);  // K·∫øt th√∫c loading
      }
    };
    checkAuth();
  }, [verifyToken]);

  // 2Ô∏è‚É£ Hi·ªÉn th·ªã loading screen trong khi verify
  if (isVerifying) {
    return (
      <div className="app" style={{...}}>
        <div>‚òï ƒêang t·∫£i...</div>
      </div>
    );
  }

  // 3Ô∏è‚É£ Render ·ª©ng d·ª•ng ch√≠nh
  return (
    <div className="app">
      <Header />
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/cart" element={<CartPage />} />
        <Route path="/menu" element={<MenuPage />} />
        <Route path="/admin" element={role === 'admin' ? <AdminDashboard /> : <Navigate to="/login" />} />
        {/* ... c√°c route kh√°c */}
      </Routes>
      <Footer />
      {/* Toast notifications */}
    </div>
  );
}
```

---

## üåä Lu·ªìng X·ª≠ L√Ω ·ª®ng D·ª•ng

### S∆° ƒê·ªì Lu·ªìng Kh·ªüi ƒê·ªông

```mermaid
graph TD
    A[User truy c·∫≠p localhost:5173] --> B[Vite dev server nh·∫≠n request]
    B --> C[Tr·∫£ v·ªÅ index.html]
    C --> D[Browser load main.jsx]
    D --> E[ReactDOM.createRoot render App]
    E --> F{Ki·ªÉm tra token trong localStorage}
    F -->|C√≥ token| G[G·ªçi API /auth/verify]
    F -->|Kh√¥ng c√≥ token| H[B·ªè qua verify]
    G --> I{Token h·ª£p l·ªá?}
    I -->|C√≥| J[Set user state trong authStore]
    I -->|Kh√¥ng| K[X√≥a token, reset state]
    J --> L[Render ·ª©ng d·ª•ng v·ªõi role]
    K --> L
    H --> L
    L --> M[React Router x√°c ƒë·ªãnh route hi·ªán t·∫°i]
    M --> N[Render component t∆∞∆°ng ·ª©ng]
```

### Chi Ti·∫øt T·ª´ng B∆∞·ªõc

#### 1. **Kh·ªüi ƒê·ªông Vite Dev Server**
```bash
npm run dev
```
- Vite ƒë·ªçc [vite.config.js](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/vite.config.js)
- Kh·ªüi ƒë·ªông server t·∫°i port 5173
- Thi·∫øt l·∫≠p proxy: `/api/*` ‚Üí `http://localhost:5000`

#### 2. **Browser Request**
```
GET http://localhost:5173/
```
- Vite tr·∫£ v·ªÅ [index.html](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/index.html)
- Browser parse HTML, t√¨m th·∫•y `<script src="/src/main.jsx">`

#### 3. **Module Loading**
```javascript
// Vite t·ª± ƒë·ªông transform JSX ‚Üí JavaScript
import App from './App.jsx'  // ‚Üí App component
import './styles.css'         // ‚Üí Inject CSS v√†o <head>
```

#### 4. **React Initialization**
```javascript
ReactDOM.createRoot(document.getElementById('root')).render(...)
```
- T·∫°o React root
- Render `<App />` v√†o `<div id="root">`

#### 5. **Authentication Check**
```javascript
useEffect(() => {
  const checkAuth = async () => {
    await verifyToken();  // G·ªçi API GET /api/auth/verify
  };
  checkAuth();
}, []);
```

**API Request:**
```http
GET http://localhost:5173/api/auth/verify
Authorization: Bearer <token_from_localStorage>

‚Üì (Proxy forward)

GET http://localhost:5000/api/auth/verify
```

#### 6. **Routing**
```javascript
<Routes>
  <Route path="/" element={<HomePage />} />
  <Route path="/menu" element={<MenuPage />} />
  {/* ... */}
</Routes>
```
- React Router so s√°nh URL hi·ªán t·∫°i v·ªõi c√°c route
- Render component t∆∞∆°ng ·ª©ng

---

## üìÅ C·∫•u Tr√∫c Th∆∞ M·ª•c

```
Frontend/
‚îú‚îÄ‚îÄ public/              # Static assets (kh√¥ng qua build process)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/      # ‚öõÔ∏è Reusable UI components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/      # Header, Footer, Sidebar
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product/     # ProductCard, ProductList
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ pages/           # üìÑ Page components (route endpoints)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home/        # HomePage.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Product/     # MenuPage.jsx, ProductReviewsPage.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Order/       # CartPage.jsx, CustomerOrdersPage.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Admin/       # AdminDashboardPage.jsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Auth/        # LoginPage.jsx
‚îÇ   ‚îú‚îÄ‚îÄ stores/          # üóÑÔ∏è Zustand state management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authStore.js      # User authentication state
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cartStore.js      # Shopping cart state
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notifyStore.js    # Toast notifications
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ services/        # üåê API calls (axios)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authService.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productService.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orderService.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ config/          # ‚öôÔ∏è Configuration files
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.js    # Route constants
‚îÇ   ‚îú‚îÄ‚îÄ constants/       # üìå App constants
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roles.js     # User roles (ADMIN, CUSTOMER)
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # üõ†Ô∏è Helper functions
‚îÇ   ‚îú‚îÄ‚îÄ hooks/           # ü™ù Custom React hooks
‚îÇ   ‚îú‚îÄ‚îÄ main.jsx         # üö™ Entry point
‚îÇ   ‚îú‚îÄ‚îÄ App.jsx          # üè† Root component
‚îÇ   ‚îî‚îÄ‚îÄ styles.css       # üé® Global styles
‚îú‚îÄ‚îÄ index.html           # HTML template
‚îú‚îÄ‚îÄ vite.config.js       # Vite configuration
‚îî‚îÄ‚îÄ package.json         # Dependencies & scripts
```

---

## üß© C√°c Th√†nh Ph·∫ßn Ch√≠nh

### 1. **State Management (Zustand)**

**authStore.js** - Qu·∫£n l√Ω authentication:
```javascript
import { create } from 'zustand';

export const useAuthStore = create((set) => ({
  user: null,
  role: null,
  token: localStorage.getItem('token'),
  
  login: async (credentials) => {
    const response = await authService.login(credentials);
    localStorage.setItem('token', response.token);
    set({ user: response.user, role: response.role, token: response.token });
  },
  
  logout: () => {
    localStorage.removeItem('token');
    set({ user: null, role: null, token: null });
  },
  
  verifyToken: async () => {
    const token = localStorage.getItem('token');
    if (!token) return;
    
    const response = await authService.verify();
    set({ user: response.user, role: response.role });
  }
}));
```

**C√°ch s·ª≠ d·ª•ng trong component:**
```javascript
function MyComponent() {
  const user = useAuthStore(s => s.user);
  const login = useAuthStore(s => s.login);
  
  return <div>Hello {user?.name}</div>;
}
```

### 2. **API Services (Axios)**

**productService.js** - G·ªçi API s·∫£n ph·∫©m:
```javascript
import axios from 'axios';

const API_URL = '/api/products';  // Proxy s·∫Ω forward ƒë·∫øn backend

export const productService = {
  getAll: async () => {
    const response = await axios.get(API_URL);
    return response.data;
  },
  
  getById: async (id) => {
    const response = await axios.get(`${API_URL}/${id}`);
    return response.data;
  },
  
  create: async (data) => {
    const response = await axios.post(API_URL, data, {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    });
    return response.data;
  }
};
```

### 3. **Routing (React Router)**

**routes.js** - ƒê·ªãnh nghƒ©a routes:
```javascript
export const ROUTES = {
  HOME: '/',
  MENU: '/menu',
  CART: '/cart',
  LOGIN: '/login',
  ADMIN: '/admin',
  MY_ORDERS: '/my-orders',
  PRODUCT_REVIEWS: (id) => `/products/${id}/reviews`,
  NOT_FOUND: '*'
};
```

**App.jsx** - S·ª≠ d·ª•ng routes:
```javascript
<Routes>
  <Route path={ROUTES.HOME} element={<HomePage />} />
  <Route path={ROUTES.MENU} element={<MenuPage />} />
  <Route 
    path={ROUTES.ADMIN} 
    element={role === ROLES.ADMIN ? <AdminDashboard /> : <Navigate to={ROUTES.LOGIN} />} 
  />
</Routes>
```

### 4. **Proxy Configuration**

**vite.config.js** - Forward API requests:
```javascript
export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      "/api": {
        target: "http://localhost:5000",  // Backend server
        changeOrigin: true,
        secure: false,
      }
    }
  }
})
```

**C√°ch ho·∫°t ƒë·ªông:**
```
Frontend Request:  GET http://localhost:5173/api/products
                   ‚Üì (Vite proxy)
Backend Receives:  GET http://localhost:5000/api/products
```

---

## üéØ T√≥m T·∫Øt Lu·ªìng Ho·∫°t ƒê·ªông

### Khi User Truy C·∫≠p Trang Ch·ªß (`/`)

```mermaid
sequenceDiagram
    participant U as User
    participant B as Browser
    participant V as Vite Server
    participant R as React App
    participant A as API Backend
    
    U->>B: Truy c·∫≠p localhost:5173
    B->>V: GET /
    V->>B: Tr·∫£ v·ªÅ index.html + main.jsx
    B->>R: Kh·ªüi t·∫°o React App
    R->>R: Render <App />
    R->>R: useEffect - checkAuth()
    R->>A: GET /api/auth/verify
    A->>R: { user, role }
    R->>R: Update authStore
    R->>R: Render <HomePage />
    R->>B: Hi·ªÉn th·ªã UI
    B->>U: Trang web hi·ªÉn th·ªã
```

### Khi User Click "Th√™m v√†o gi·ªè h√†ng"

```mermaid
sequenceDiagram
    participant U as User
    participant C as Component
    participant S as cartStore
    participant L as localStorage
    
    U->>C: Click "Th√™m v√†o gi·ªè"
    C->>S: addToCart(product)
    S->>S: Update cart state
    S->>L: L∆∞u cart v√†o localStorage
    S->>C: Trigger re-render
    C->>U: Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng m·ªõi
```

### Khi User ƒê·∫∑t H√†ng

```mermaid
sequenceDiagram
    participant U as User
    participant C as CartPage
    participant S as orderService
    participant A as API Backend
    participant D as Database
    
    U->>C: Click "ƒê·∫∑t h√†ng"
    C->>S: createOrder(orderData)
    S->>A: POST /api/orders
    A->>D: INSERT order
    D->>A: Success
    A->>S: { orderId, status }
    S->>C: Order created
    C->>U: Chuy·ªÉn ƒë·∫øn trang thanh to√°n
```

---

## üí° Nh·ªØng ƒêi·ªÉm Quan Tr·ªçng C·∫ßn Nh·ªõ

### 1. **Hot Module Replacement (HMR)**
- Khi b·∫°n s·ª≠a code, Vite t·ª± ƒë·ªông reload trang
- Kh√¥ng c·∫ßn restart server
- State ƒë∆∞·ª£c gi·ªØ nguy√™n (trong h·∫ßu h·∫øt tr∆∞·ªùng h·ª£p)

### 2. **Proxy API Requests**
- Frontend: `localhost:5173`
- Backend: `localhost:5000`
- M·ªçi request ƒë·∫øn `/api/*` ƒë∆∞·ª£c forward t·ª± ƒë·ªông

### 3. **State Persistence**
- `authStore` l∆∞u token trong `localStorage`
- `cartStore` l∆∞u gi·ªè h√†ng trong `localStorage`
- Khi refresh trang, data v·∫´n c√≤n

### 4. **Protected Routes**
```javascript
<Route 
  path="/admin" 
  element={role === 'admin' ? <AdminDashboard /> : <Navigate to="/login" />} 
/>
```
- Ki·ªÉm tra role tr∆∞·ªõc khi render
- Redirect n·∫øu kh√¥ng c√≥ quy·ªÅn

### 5. **Component Lifecycle**
```javascript
useEffect(() => {
  // Ch·∫°y khi component mount
  fetchData();
  
  return () => {
    // Cleanup khi component unmount
    cancelRequest();
  };
}, [dependencies]);  // Ch·∫°y l·∫°i khi dependencies thay ƒë·ªïi
```

---

## üöÄ C√°c L·ªánh Th∆∞·ªùng D√πng

| L·ªánh | Ch·ª©c NƒÉng |
|------|-----------|
| `npm run dev` | Kh·ªüi ƒë·ªông dev server (port 5173) |
| `npm run build` | Build production bundle |
| `npm run preview` | Preview production build |

---

## üîç Debug Tips

### 1. **Ki·ªÉm tra Network Requests**
- M·ªü DevTools (F12) ‚Üí Tab Network
- Xem c√°c API calls v√† response

### 2. **Ki·ªÉm tra State**
```javascript
// Th√™m v√†o component
console.log('Current state:', useAuthStore.getState());
```

### 3. **React DevTools**
- C√†i extension React DevTools
- Xem component tree v√† props/state

### 4. **Ki·ªÉm tra localStorage**
```javascript
// Console
localStorage.getItem('token')
localStorage.getItem('cart')
```

---

## üìö T√†i Li·ªáu Tham Kh·∫£o

- [Vite Documentation](https://vitejs.dev/)
- [React Documentation](https://react.dev/)
- [React Router](https://reactrouter.com/)
- [Zustand](https://github.com/pmndrs/zustand)
- [Axios](https://axios-http.com/)

---

**Ch√∫c b·∫°n code vui v·∫ª! ‚òï‚ú®**
