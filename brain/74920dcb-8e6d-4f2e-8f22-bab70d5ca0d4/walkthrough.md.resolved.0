# Sửa lỗi hiển thị đánh giá sản phẩm

## Vấn đề
Các số đánh giá và rating (sao) không hiển thị trên các thẻ sản phẩm ở trang chủ, ngay cả khi người dùng chưa đăng nhập.

## Nguyên nhân
1. **Thiếu load reviews**: Trang [HomePage.jsx](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/pages/Home/HomePage.jsx) không gọi API để tải danh sách đánh giá khi trang được load
2. **Lỗi CORS**: Backend chỉ cho phép requests từ `http://localhost:5173`, nhưng frontend đang chạy trên port khác (5174)

## Giải pháp đã thực hiện

### 1. Thêm load reviews vào HomePage

**File**: [Frontend/src/pages/Home/HomePage.jsx](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/src/pages/Home/HomePage.jsx)

**Thay đổi**:
- Thêm import `useReviewStore`
- Gọi `loadReviews()` trong `useEffect` khi component mount

```javascript
// Thêm import
import { useReviewStore } from '../../stores/reviewStore.js'

// Thêm vào component
const loadReviews = useReviewStore((s) => s.loadFromAPI)

// Thêm useEffect để load reviews
useEffect(() => {
  loadReviews()
}, [loadReviews])
```

### 2. Sửa cấu hình CORS ở backend

**File**: [backend/app.js](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/backend/app.js)

**Thay đổi**: Cho phép nhiều localhost ports trong development

```javascript
// CORS configuration
const allowedOrigins = [
  process.env.FRONTEND_URL || 'http://localhost:3000',
  'http://localhost:5173',
  'http://localhost:5174',
  'http://localhost:3000'
];

app.use(cors({
  origin: function (origin, callback) {
    // Allow requests with no origin (like mobile apps or curl requests)
    if (!origin) return callback(null, true);
    
    // Check if the origin is in the allowed list
    if (allowedOrigins.indexOf(origin) !== -1) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true
}));
```

## Kết quả kiểm tra

✅ **Thành công!** Sau khi thực hiện các thay đổi:

1. **Không còn lỗi CORS**: Console không còn hiển thị lỗi CORS khi gọi API `/api/reviews`
2. **API calls thành công**: Requests đến `/api/reviews` đã thành công
3. **Hiển thị đúng trên UI**: 
   - Sản phẩm **Milo Dầm** hiển thị **(3)** đánh giá với 5 sao vàng ⭐⭐⭐⭐⭐
   - Các sản phẩm khác hiển thị **(0)** đánh giá (vì chưa có dữ liệu trong database)

![Screenshot showing reviews on product cards](file:///C:/Users/HPPAVILION/.gemini/antigravity/brain/74920dcb-8e6d-4f2e-8f22-bab70d5ca0d4/homepage_scrolled.png)

## Lưu ý quan trọng

- **Người dùng chưa đăng nhập** vẫn có thể **xem** đánh giá và rating
- **Chỉ người dùng đã mua và nhận hàng** mới có thể **tạo** đánh giá mới
- Backend API `/api/reviews` (GET) không yêu cầu authentication, cho phép mọi người xem đánh giá

## Video demo

Xem video ghi lại quá trình kiểm tra:

![Browser recording](file:///C:/Users/HPPAVILION/.gemini/antigravity/brain/74920dcb-8e6d-4f2e-8f22-bab70d5ca0d4/review_working_test_1766045615031.webp)
