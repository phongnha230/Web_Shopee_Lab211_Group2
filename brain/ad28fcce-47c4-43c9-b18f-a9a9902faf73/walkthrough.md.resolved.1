# Docker Deployment Guide - Cafe App

## ‚úÖ Deployment ho√†n t·∫•t

### C√°c file ƒë√£ t·∫°o

| File | V·ªã tr√≠ | M·ª•c ƒë√≠ch |
|------|--------|----------|
| [Dockerfile](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/backend/Dockerfile) | `backend/` | Build backend container |
| [Dockerfile](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/Dockerfile) | `Frontend/` | Build frontend container |
| [nginx.conf](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/nginx.conf) | `Frontend/` | Config Nginx web server |
| [docker-compose.yml](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/docker-compose.yml) | [my-app/](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app) | Orchestrate all services |
| [.dockerignore](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/backend/.dockerignore) | `backend/` | Exclude files from build |
| [.dockerignore](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/Frontend/.dockerignore) | `Frontend/` | Exclude files from build |

---

## üîß C√°c thay ƒë·ªïi ƒë√£ th·ª±c hi·ªán

### 1. Backend ([app.js](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/backend/app.js#L66-L70))
- Th√™m static file serving cho `/src/assets` ƒë·ªÉ serve ·∫£nh s·∫£n ph·∫©m

### 2. Docker Compose ([docker-compose.yml](file:///c:/Users/HPPAVILION/Documents/Cusor/Cafe_app/my-app/docker-compose.yml#L40-L42))
- Th√™m volume mount ƒë·ªÉ share folder `Frontend/src/assets` v·ªõi backend container
- MySQL port: **3307** (tr√°nh conflict v·ªõi MySQL local)

### 3. Database
- Import data v·ªõi UTF-8 encoding ƒë·ªÉ hi·ªÉn th·ªã ƒë√∫ng ti·∫øng Vi·ªát

---

## üöÄ C√°c l·ªánh Docker quan tr·ªçng

### Build v√† Ch·∫°y

```powershell
# Build v√† ch·∫°y t·∫•t c·∫£ services
cd c:\Users\HPPAVILION\Documents\Cusor\Cafe_app\my-app
docker-compose up -d --build

# Ch·ªâ ch·∫°y (kh√¥ng build l·∫°i)
docker-compose up -d
```

### Xem Logs

```powershell
# Xem logs t·∫•t c·∫£ services
docker-compose logs -f

# Xem logs c·ªßa service c·ª• th·ªÉ
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f mysql
```

### D·ª´ng Services

```powershell
# D·ª´ng t·∫•t c·∫£ containers
docker-compose down

# D·ª´ng v√† x√≥a volumes (‚ö†Ô∏è X√ìA DATABASE)
docker-compose down -v
```

### Rebuild m·ªôt service

```powershell
# Rebuild backend
docker-compose up -d --build backend

# Rebuild frontend
docker-compose up -d --build frontend
```

---

## üåê Truy c·∫≠p ·ª©ng d·ª•ng

| Service | URL |
|---------|-----|
| **Frontend** | http://localhost |
| **Backend API** | http://localhost:5000 |
| **MySQL** | localhost:3307 |

---

## ‚úÖ Ki·ªÉm tra deployment

### 1. Ki·ªÉm tra containers ƒëang ch·∫°y

```powershell
docker-compose ps
```

K·∫øt qu·∫£ mong ƒë·ª£i:
```
cafe_mysql      Healthy
cafe_backend    Started
cafe_frontend   Started
```

### 2. Ki·ªÉm tra ti·∫øng Vi·ªát

```powershell
docker exec cafe_mysql mysql -u root -pAnhnha@1905 --default-character-set=utf8mb4 -e "SELECT id, name FROM products LIMIT 3;" coffeeshop
```

Ph·∫£i hi·ªÉn th·ªã: `N∆∞·ªõc B·∫°c H√†`, `N∆∞·ªõc D·ª´a h·∫•u`, v.v... (kh√¥ng c√≥ k√Ω t·ª± l·∫°)

### 3. Ki·ªÉm tra ·∫£nh

M·ªü http://localhost v√† xem c√°c s·∫£n ph·∫©m c√≥ hi·ªÉn th·ªã ·∫£nh kh√¥ng.

---

## üêõ Troubleshooting

### V·∫•n ƒë·ªÅ 1: Port conflict (3307)

**L·ªói:** `bind: Only one usage of each socket address`

**Gi·∫£i ph√°p:** T·∫Øt MySQL local
```powershell
net stop MySQL84
```

### V·∫•n ƒë·ªÅ 2: Ti·∫øng Vi·ªát b·ªã l·ªói

**Nguy√™n nh√¢n:** Database kh√¥ng d√πng UTF-8

**Gi·∫£i ph√°p:** Re-import v·ªõi charset ƒë√∫ng
```powershell
docker-compose down -v
net start MySQL84
mysqldump -u root -pAnhnha@1905 -P 3307 --default-character-set=utf8mb4 --result-file=backup.sql coffeeshop
net stop MySQL84
docker-compose up -d
docker cp backup.sql cafe_mysql:/tmp/
docker exec cafe_mysql sh -c "mysql -u root -pAnhnha@1905 --default-character-set=utf8mb4 coffeeshop < /tmp/backup.sql"
```

### V·∫•n ƒë·ªÅ 3: ·∫¢nh kh√¥ng hi·ªÉn th·ªã

**Nguy√™n nh√¢n:** Assets folder kh√¥ng ƒë∆∞·ª£c mount v√†o backend

**Gi·∫£i ph√°p:** ƒê√£ fix b·∫±ng volume mount trong `docker-compose.yml`

---

## üìù L∆∞u √Ω quan tr·ªçng

> [!IMPORTANT]
> - ƒê·∫£m b·∫£o **Docker Desktop ƒëang ch·∫°y** tr∆∞·ªõc khi th·ª±c hi·ªán c√°c l·ªánh
> - **T·∫Øt MySQL local** n·∫øu ƒëang ch·∫°y tr√™n port 3307
> - **L·∫ßn ƒë·∫ßu ch·∫°y** s·∫Ω m·∫•t v√†i ph√∫t ƒë·ªÉ download images v√† build
> - Data ƒë∆∞·ª£c l∆∞u trong Docker volume `my-app_mysql_data`

> [!WARNING]
> L·ªánh `docker-compose down -v` s·∫Ω **X√ìA TO√ÄN B·ªò DATABASE**. Ch·ªâ d√πng khi mu·ªën reset ho√†n to√†n.

