<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In | GoShop</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Custom Scrollbar if needed */
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
    </style>
</head>

<!-- SHOPEE STYLE HEADER -->
<!-- SHOPEE STYLE HEADER -->
<header class="w-full bg-white shadow-sm py-4">
    <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <a href="index.html" class="flex items-center gap-2 text-[#AD3029] hover:opacity-90">
                <i class="fas fa-shopping-bag text-4xl"></i>
                <span class="text-3xl font-bold">GoShop</span>
            </a>
            <span class="text-xl text-gray-800 font-medium" data-i18n="auth.login.title">Log In</span>
        </div>
        <div class="flex items-center gap-4">
            <button id="lang-toggle"
                class="text-sm font-bold text-gray-600 hover:text-[#AD3029] uppercase flex items-center">
                <img src="https://flagcdn.com/24x18/gb.png" alt="English"
                    class="inline-block mr-1.5 w-5 h-auto object-cover border border-gray-200"> English
            </button>
        </div>
    </div>
</header>

<!-- MAIN CONTENT - RED BACKGROUND -->
<div class="w-full bg-[#AD3029] min-h-[600px] flex items-center justify-center py-10">
    <div class="max-w-7xl w-full mx-auto px-4 flex items-center justify-between">

        <!-- LEFT SIDE: BRANDING / LOGO (Shopee Style) -->
        <div class="hidden lg:flex flex-col items-center justify-center w-1/2 text-white space-y-8">
            <i class="fas fa-shopping-bag text-[150px] opacity-90 animate-bounce"></i>
            <div class="text-center">
                <h2 class="text-4xl font-bold mb-2" data-i18n="auth.branding.title">The Best Online Shopping</h2>
                <p class="text-xl opacity-90" data-i18n="auth.branding.subtitle">Join GoShop today!</p>
            </div>
        </div>

        <!-- RIGHT SIDE: WHITE FORM CARD -->
        <div class="bg-white rounded-md shadow-lg p-10 w-full lg:w-[450px] mx-auto lg:mx-0">
            <h3 class="text-2xl font-medium text-gray-800 mb-6" data-i18n="auth.login.title">Log In</h3>

            <!-- LOGIN FORM INPUTS -->
            <div class="space-y-4">
                <input id="loginEmail" data-i18n="auth.email_placeholder" placeholder="Email"
                    class="w-full px-4 py-3 border border-gray-300 rounded-sm focus:border-[#AD3029] focus:ring-1 focus:ring-[#AD3029] outline-none transition text-sm">

                <input id="loginPassword" type="password" data-i18n="auth.password_placeholder" placeholder="Password"
                    class="w-full px-4 py-3 border border-gray-300 rounded-sm focus:border-[#AD3029] focus:ring-1 focus:ring-[#AD3029] outline-none transition text-sm">
            </div>

            <div class="text-right mt-2 mb-6">
                <a href="/forgot-password.html" class="text-xs text-[#AD3029] hover:underline"
                    data-i18n="auth.forgot_password">
                    Forgot Password?
                </a>
            </div>

            <!-- SIGN IN BUTTON -->
            <button onclick="signIn()" data-i18n="auth.login_btn"
                class="w-full py-3 bg-[#AD3029] text-white text-sm font-semibold rounded-sm hover:bg-[#8f2621] shadow-sm uppercase tracking-wide transition-colors">
                Log In
            </button>

            <!-- DIVIDER -->
            <div class="flex items-center my-6">
                <div class="flex-1 h-px bg-gray-200"></div>
                <span class="mx-4 text-xs text-gray-400 uppercase" data-i18n="auth.or">Or</span>
                <div class="flex-1 h-px bg-gray-200"></div>
            </div>

            <!-- SOCIAL BUTTONS -->
            <div class="mt-4">
                <button onclick="googleLogin(event)"
                    class="w-full py-2 border border-gray-300 rounded-sm flex items-center justify-center gap-2 hover:bg-gray-50 transition">
                    <svg class="w-4 h-4" viewBox="0 0 48 48">
                        <path fill="#EA4335"
                            d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.73 17.74 9.5 24 9.5z" />
                        <path fill="#4285F4"
                            d="M46.14 24.56c0-1.64-.15-3.21-.43-4.72H24v9.02h12.45c-.54 2.91-2.18 5.38-4.64 7.04l7.49 5.82c4.38-4.04 6.84-9.99 6.84-17.16z" />
                        <path fill="#FBBC05"
                            d="M10.53 28.77A14.5 14.5 0 0 1 9.76 24c0-1.66.29-3.21.77-4.77l-7.99-6.19A23.99 23.99 0 0 0 0 24c0 3.88.93 7.56 2.54 10.96l7.99-6.19z" />
                        <path fill="#34A853"
                            d="M24 48c6.48 0 11.93-2.13 15.9-5.81l-7.49-5.82c-2.08 1.4-4.73 2.23-8.41 2.23-6.26 0-11.57-4.23-13.46-9.94l-7.99 6.19C6.51 42.62 14.62 48 24 48z" />
                    </svg>
                    <span class="text-sm text-gray-600" data-i18n="auth.continue_google">Continue with Google</span>
                </button>
            </div>

            <div class="mt-8 text-center text-sm">
                <span class="text-gray-400" data-i18n="auth.new_user">New to GoShop?</span>
                <a href="register.html" class="text-[#AD3029] font-medium ml-1" data-i18n="auth.signup_link">Sign Up</a>
            </div>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer class="bg-gray-50 py-8 border-t border-gray-200">
    <div class="max-w-7xl mx-auto px-4 text-center">
        <div class="flex justify-center gap-8 mb-4 text-xs text-gray-500 uppercase">
            <a href="#" class="hover:text-gray-800">Privacy Policy</a>
            <a href="#" class="hover:text-gray-800">Terms of Service</a>
            <a href="#" class="hover:text-gray-800">Help Center</a>
        </div>
        <p class="text-xs text-gray-400">&copy; 2026 GoShop. All rights reserved.</p>
    </div>
</footer>


<script src="js/translations.js"></script>
<script src="js/i18n.js"></script>
<script>
    async function signIn() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value.trim();
        const btn = document.querySelector('button[onclick="signIn()"]');
        const originalText = btn.innerText;

        if (!email || !password) {
            alert('âš ï¸ Please enter email and password!');
            return;
        }

        // Disable button
        btn.disabled = true;
        btn.innerText = 'Signing in...';
        btn.classList.add('opacity-70', 'cursor-not-allowed');

        try {
            const response = await fetch('http://localhost:8080/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('accessToken', data.accessToken);
                localStorage.setItem('userName', data.user?.fullName || email.split('@')[0]);
                if (data.user) localStorage.setItem('user', JSON.stringify(data.user));
                if (data.user?.id) localStorage.setItem('userId', data.user.id);

                const roles = data.user?.roles || [];
                const isAdmin = roles.some(r => (typeof r === 'string' ? r : r.name) === 'ROLE_ADMIN');

                const returnUrl = new URLSearchParams(window.location.search).get('returnUrl');
                if (returnUrl) {
                    const m = returnUrl.match(/order-detail\.html\?id=([^&]+)/);
                    if (m) localStorage.setItem('viewOrderId', m[1]);
                    window.location.href = returnUrl;
                } else if (isAdmin) {
                    window.location.href = 'admin-dashboard.html';
                } else {
                    window.location.href = 'index.html';
                }
            } else {
                alert('âŒ ' + (data.message || 'Login failed'));
                // Re-enable button on error
                btn.disabled = false;
                btn.innerText = originalText;
                btn.classList.remove('opacity-70', 'cursor-not-allowed');
            }
        } catch (error) {
            console.error(error);
            alert('âŒ Server connection error');
            // Re-enable button on error
            btn.disabled = false;
            btn.innerText = originalText;
            btn.classList.remove('opacity-70', 'cursor-not-allowed');
        }
    }

    async function googleLogin(event) {
        event.preventDefault();

        try {
            const res = await fetch(
                'http://localhost:8080/api/auth/oauth/google/url?redirect_uri=http://localhost:3000/auth/callback/google.html'
            );

            const data = await res.json();

            if (data.authUrl) {
                // ðŸ”¥ SWITCH TO GOOGLE
                window.location.href = data.authUrl;
            } else {
                alert('âŒ Could not get Google URL');
            }
        } catch (err) {
            alert('âŒ Google Login Error');
            console.error(err);
        }
    }

    // === ENTER KEY SUPPORT ===
    document.addEventListener('DOMContentLoaded', function () {
        const inputs = document.querySelectorAll('#loginEmail, #loginPassword');
        inputs.forEach(input => {
            input.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    signIn(); // Call function directly
                }
            });
        });
    });
</script>
</body>

</html>