<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up | GoShop</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Scrollbar if needed */
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
    </style>
</head>

<!-- SHOPEE STYLE HEADER -->
<header class="w-full bg-white shadow-sm py-4">
    <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <a href="index.html" class="flex items-center gap-2 text-[#AD3029] hover:opacity-90">
                <i class="fas fa-shopping-bag text-4xl"></i>
                <span class="text-3xl font-bold">GoShop</span>
            </a>
            <span class="text-xl text-gray-800 font-medium">Sign Up</span>
        </div>
        <div class="flex items-center gap-4">
            <!-- Language Toggle Removed -->
        </div>
    </div>
</header>

<!-- MAIN CONTENT - RED BACKGROUND -->
<div class="w-full bg-[#AD3029] min-h-[600px] flex items-center justify-center py-10">
    <div class="max-w-7xl w-full mx-auto px-4 flex items-center justify-between">

        <!-- LEFT SIDE: BRANDING / LOGO (Shopee Style) -->
        <div class="hidden lg:flex flex-col items-center justify-center w-1/2 text-white space-y-8">
            <i class="fas fa-shopping-bag text-[150px] opacity-90 animate-bounce"></i>
            <div class="text-center">
                <h2 class="text-4xl font-bold mb-2">The Best Online Shopping</h2>
                <p class="text-xl opacity-90">Join GoShop today!</p>
            </div>
        </div>

        <!-- RIGHT SIDE: WHITE FORM CARD -->
        <div class="bg-white rounded-md shadow-lg p-10 w-full lg:w-[450px] mx-auto lg:mx-0">
            <h3 class="text-2xl font-medium text-gray-800 mb-6">Sign Up</h3>

            <!-- FORM INPUTS -->
            <div class="space-y-4">
                <input id="fullName" placeholder="Full Name" type="text"
                    class="w-full px-4 py-3 border border-gray-300 rounded-sm focus:border-[#AD3029] focus:ring-1 focus:ring-[#AD3029] outline-none transition text-sm">

                <input id="email" placeholder="Email" type="email"
                    class="w-full px-4 py-3 border border-gray-300 rounded-sm focus:border-[#AD3029] focus:ring-1 focus:ring-[#AD3029] outline-none transition text-sm">

                <input id="phone" placeholder="Phone Number" type="text"
                    class="w-full px-4 py-3 border border-gray-300 rounded-sm focus:border-[#AD3029] focus:ring-1 focus:ring-[#AD3029] outline-none transition text-sm">

                <input id="password" placeholder="Password" type="password"
                    class="w-full px-4 py-3 border border-gray-300 rounded-sm focus:border-[#AD3029] focus:ring-1 focus:ring-[#AD3029] outline-none transition text-sm">
            </div>

            <!-- SIGN UP BUTTON -->
            <button onclick="goToOTP()"
                class="w-full mt-8 py-3 bg-[#AD3029] text-white text-sm font-semibold rounded-sm hover:bg-[#8f2621] shadow-sm uppercase tracking-wide transition-colors">
                Sign Up
            </button>

            <!-- DIVIDER -->
            <div class="flex items-center my-6">
                <div class="flex-1 h-px bg-gray-200"></div>
                <span class="mx-4 text-xs text-gray-400 uppercase">Or</span>
                <div class="flex-1 h-px bg-gray-200"></div>
            </div>

            <!-- SOCIAL BUTTONS -->
            <div class="mt-4">
                <button onclick="googleLogin(event)"
                    class="w-full py-2 border border-gray-300 rounded-sm flex items-center justify-center gap-2 hover:bg-gray-50 transition">
                    <svg class="w-4 h-4" viewBox="0 0 48 48">
                        <path fill="#EA4335"
                            d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.73 17.74 9.5 24 9.5z" />
                        <path fill="#4285F4"
                            d="M46.14 24.56c0-1.64-.15-3.21-.43-4.72H24v9.02h12.45c-.54 2.91-2.18 5.38-4.64 7.04l7.49 5.82c4.38-4.04 6.84-9.99 6.84-17.16z" />
                        <path fill="#FBBC05"
                            d="M10.53 28.77A14.5 14.5 0 0 1 9.76 24c0-1.66.29-3.27.77-4.77l-7.99-6.19A23.99 23.99 0 0 0 0 24c0 3.88.93 7.56 2.54 10.96l7.99-6.19z" />
                        <path fill="#34A853"
                            d="M24 48c6.48 0 11.93-2.13 15.9-5.81l-7.49-5.82c-2.08 1.4-4.73 2.23-8.41 2.23-6.26 0-11.57-4.23-13.46-9.94l-7.99 6.19C6.51 42.62 14.62 48 24 48z" />
                    </svg>
                    <span class="text-sm text-gray-600">Continue with Google</span>
                </button>
            </div>

            <div class="mt-8 text-center text-sm">
                <span class="text-gray-400">Have an account?</span>
                <a href="login.html" class="text-[#AD3029] font-medium ml-1">Sign In</a>
            </div>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer class="bg-gray-50 py-8 border-t border-gray-200">
    <div class="max-w-7xl mx-auto px-4 text-center">
        <div class="flex justify-center gap-8 mb-4 text-xs text-gray-500 uppercase">
            <a href="#" class="hover:text-gray-800">Privacy Policy</a>
            <a href="#" class="hover:text-gray-800">Terms of Service</a>
            <a href="#" class="hover:text-gray-800">Help Center</a>
        </div>
        <p class="text-xs text-gray-400">&copy; 2026 GoShop. All rights reserved.</p>
    </div>
</footer>



<script>
    async function goToOTP() {
        const fullName = document.getElementById('fullName').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const password = document.getElementById('password').value;
        const btn = document.querySelector('button[onclick="goToOTP()"]');
        const originalText = btn.innerText;

        if (!fullName || !email || !password || !phone) {
            alert('âš ï¸ Please fill in all required fields!');
            return;
        }

        // Validate Phone (VN format: 10 digits, starts with 0)
        const phoneRegex = /^0\d{9}$/;
        if (!phoneRegex.test(phone)) {
            alert('âŒ Phone number must be 10 digits and start with 0 (e.g., 0912345678)!');
            return;
        }

        // Validate Password Regex
        const strongPasswordRegex = /^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
        if (!strongPasswordRegex.test(password)) {
            alert('âŒ Password must be at least 8 characters, include uppercase, lowercase, and number!');
            return;
        }

        // Disable button
        btn.disabled = true;
        btn.innerText = 'Processing...';
        btn.classList.add('opacity-70', 'cursor-not-allowed');

        // Save to localStorage for OTP step
        localStorage.setItem('pendingEmail', email);
        localStorage.setItem('pendingPassword', password);
        localStorage.setItem('pendingName', fullName);
        localStorage.setItem('pendingPhone', phone);

        try {
            // Call Register API (Backend will send OTP automatically)
            const res = await fetch('http://localhost:8080/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    fullName: fullName,
                    email: email,
                    phone: phone,
                    password: password
                })
            });

            const data = await res.json();

            if (res.ok) {
                alert('âœ… Registration successful! OTP sent to your email.');
                window.location.href = 'otp.html';
            } else {
                // FALLBACK: If email already exists, try to resend OTP (user might have failed verification previously)
                if (data.message && (data.message.includes('Email already exists') || data.message.includes('Email Ä‘Ã£ tá»“n táº¡i'))) {
                    const confirmResend = confirm('âš ï¸ Email already registered. Do you want to receive a new OTP to verify this account?');
                    if (confirmResend) {
                        try {
                            const otpRes = await fetch('http://localhost:8080/api/auth/send-otp', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ email })
                            });
                            if (otpRes.ok) {
                                alert('âœ… New OTP sent! Redirecting to verification...');
                                window.location.href = 'otp.html';
                                return;
                            }
                        } catch (e) {
                            console.error(e);
                        }
                    }
                }

                alert('âŒ ' + (data.message || 'Registration failed'));
                // Re-enable button on error
                btn.disabled = false;
                btn.innerText = originalText;
                btn.classList.remove('opacity-70', 'cursor-not-allowed');
            }
        } catch (err) {
            console.error(err);
            alert('âŒ Server connection error');
            // Re-enable button on error
            btn.disabled = false;
            btn.innerText = originalText;
            btn.classList.remove('opacity-70', 'cursor-not-allowed');
        }
    }

    async function googleLogin(event) {
        event.preventDefault();

        try {
            const res = await fetch(
                'http://localhost:8080/api/auth/oauth/google/url?redirect_uri=http://localhost:3000/auth/callback/google.html'
            );

            const data = await res.json();

            if (data.authUrl) {
                // ðŸ”¥ SWITCH TO GOOGLE
                window.location.href = data.authUrl;
            } else {
                alert('âŒ Could not get Google URL');
            }
        } catch (err) {
            alert('âŒ Google Login Error');
            console.error(err);
        }
    }

    // === ENTER KEY SUPPORT ===
    document.addEventListener('DOMContentLoaded', function () {
        const inputs = document.querySelectorAll('#fullName, #email, #phone, #password');
        inputs.forEach(input => {
            input.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    goToOTP(); // Call function directly
                }
            });
        });
    });
</script>
</body>

</html>