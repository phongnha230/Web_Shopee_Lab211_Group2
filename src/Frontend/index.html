<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoShop - Best Online Shopping Experience</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'marquee-left': 'marquee-left 25s linear infinite',
                        'marquee-right': 'marquee-right 25s linear infinite',
                    },
                    keyframes: {
                        'marquee-left': {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-50%)' }, // Move left by 50% (since we duplicated content)
                        },
                        'marquee-right': {
                            '0%': { transform: 'translateX(-50%)' }, // Start pushed left
                            '100%': { transform: 'translateX(0)' },   // Move right back to 0
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
    </style>

</head>

<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-[#AD3029] text-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20 gap-8">
                <!-- 1. Logo Section --><a href="index.html"
                    class="flex items-center gap-2 group flex-shrink-0 hover:opacity-90 transition"><i
                        class="fas fa-shopping-bag text-3xl text-white bounce-goshop"></i><span
                        class="text-2xl font-bold tracking-tight">GoShop</span></a>
                <!-- 2. Search Section (Centered & Wide) -->
                <div class="flex-1 max-w-2xl relative">
                    <div class="relative group"><input id="globalSearchInput" type="text"
                            placeholder="Search products..."
                            class="w-full h-10 pl-4 pr-12 rounded-sm text-black focus:outline-none shadow-inner transition border-2 border-transparent focus:border-red-300"><button
                            id="globalSearchButton"
                            class="absolute right-0 top-0 h-10 w-12 bg-[#DC2626] hover:bg-[#B91C1C] flex items-center justify-center rounded-r-sm transition"><i
                                class="fas fa-search text-white"></i></button></div>
                </div>
                <!-- 3. Actions Section (Right) -->
                <div class="flex items-center gap-6">
                    <!-- Language Toggle Removed -->
                    <!-- Notifications -->
                    <div class="relative group h-full flex items-center"><button
                            class="hover:opacity-80 transition relative p-2"><i class="far fa-bell text-xl"></i>
                            <!-- Badge could go here -->
                        </button>
                        <!-- Dropdown -->
                        <div class="hidden group-hover:block absolute top-full right-0 pt-2 w-72 z-50">
                            <div
                                class="bg-white text-black shadow-xl rounded-lg border border-gray-200 overflow-hidden">
                                <div class="p-3 border-b bg-gray-50 flex justify-between items-center">
                                    <span class="text-sm font-semibold text-gray-700">Notifications</span><button
                                        class="text-xs text-blue-600 hover:underline">Mark
                                        all read</button>
                                </div>
                                <div class="p-8 text-center text-sm text-gray-500 flex flex-col items-center">
                                    <i class="far fa-bell-slash text-2xl mb-2 text-gray-300"></i>No
                                    new notifications
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Cart --><a href="cart-backend.html" class="relative hover:opacity-80 transition p-1"><i
                            class="fas fa-shopping-cart text-xl"></i><span id="cartBadge"
                            class="absolute -top-1 -right-1 bg-white text-[#AD3029] text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm hidden">0</span></a>
                    <div class="h-6 w-px bg-white/30"></div>
                    <!-- Auth Actions -->
                    <!-- Guest -->
                    <div id="guestNav" class="flex items-center gap-3 font-medium text-sm"><a href="register.html"
                            class="hover:text-gray-200 transition">Sign Up</a><a href="login.html"
                            class="hover:text-gray-200 transition">Sign in</a></div>
                    <!-- User -->
                    <div id="userNav" class="hidden flex items-center gap-2 cursor-pointer relative group h-full">
                        <img src="https://ui-avatars.com/api/?name=User&background=fecaca&color=AD3029"
                            class="w-8 h-8 rounded-full border-2 border-white/50" id="userAvatar"><span id="userName"
                            class="font-semibold max-w-[100px] truncate hidden md:block">User</span>
                        <!-- Dropdown -->
                        <div class="absolute right-0 top-full pt-2 w-48 hidden group-hover:block z-50 animate-fade-in">
                            <div class="bg-white text-black rounded-md shadow-lg py-1 border border-gray-100">
                                <a href="profile.html" class="block px-4 py-2 text-sm hover:bg-gray-100 transition"><i
                                        class="far fa-user mr-2 text-gray-400"></i>My
                                    Profile</a><a href="my-orders-backend.html"
                                    class="block px-4 py-2 text-sm hover:bg-gray-100 transition"><i
                                        class="fas fa-box mr-2 text-gray-400"></i>My
                                    Orders</a>
                                <!-- Shop Link (Dynamic) --><a href="#" id="sellerChannelLink"
                                    class="block px-4 py-2 text-sm hover:bg-gray-100 transition hidden"><i
                                        class="fas fa-store mr-2 text-gray-400"></i>My
                                    Shop</a>
                                <!-- Admin Link (Dynamic) --><a href="admin-dashboard.html" id="adminPanelLink"
                                    class="block px-4 py-2 text-sm hover:bg-gray-100 transition font-bold text-red-600 hidden"><i
                                        class="fas fa-user-shield mr-2"></i>Admin
                                    Panel</a>
                                <div class="border-t border-gray-100 my-1">
                                </div><button onclick="logout()"
                                    class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition"><i
                                        class="fas fa-sign-out-alt mr-2"></i>Logout</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Banner Section (Carousel) -->
    <!-- Banner Section (Carousel) -->
    <!-- Banner Section (Carousel) -->
    <section class="mb-4 mt-8">
        <div class="max-w-[1200px] mx-auto">
            <div id="heroCarousel" class="relative group w-full aspect-[21/9] overflow-hidden shadow-lg">
                <!-- Slides Container -->
                <div class="flex transition-transform duration-700 ease-out h-full" id="carouselSlides">
                    <!-- Slide 1 (Master Height - Fixed Ratio) -->
                    <div class="w-full h-full flex-shrink-0 relative">
                        <img src="assets/banner01.png" class="absolute inset-0 w-full h-full object-cover"
                            alt="Freeship 50k Banner">
                    </div>
                    <!-- Slide 2 (Follows Slide 1 Height - Cropped if needed) -->
                    <div class="w-full flex-shrink-0 relative">
                        <img src="assets/banner02.png" class="absolute inset-0 w-full h-full object-cover"
                            alt="Weekly Thursday Banner">
                    </div>
                    <!-- Slide 3 (Follows Slide 1 Height - Cropped if needed) -->
                    <div class="w-full flex-shrink-0 relative">
                        <img src="assets/banner03.png" class="absolute inset-0 w-full h-full object-cover"
                            alt="Brand Deals Banner">
                    </div>
                    <!-- Slide 4 (Follows Slide 1 Height - Cropped if needed) -->
                    <div class="w-full flex-shrink-0 relative">
                        <img src="assets/banner04.png" class="absolute inset-0 w-full h-full object-cover"
                            alt="Promotion Banner 1">
                    </div>
                    <!-- Slide 5 (Follows Slide 1 Height - Cropped if needed) -->
                    <div class="w-full flex-shrink-0 relative">
                        <img src="assets/banner05.png" class="absolute inset-0 w-full h-full object-cover"
                            alt="Flash Sale Day Banner">
                    </div>
                    <!-- Slide 6 (Follows Slide 1 Height - Cropped if needed) -->
                    <div class="w-full flex-shrink-0 relative">
                        <img src="assets/banner06.png" class="absolute inset-0 w-full h-full object-cover"
                            alt="Banner 06">
                    </div>
                </div>

                <!-- Indicators (Dots) -->
                <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
                    <button class="w-3 h-3 rounded-full bg-white scale-125 transition" onclick="goToSlide(0)"></button>
                    <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition"
                        onclick="goToSlide(1)"></button>
                    <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition"
                        onclick="goToSlide(2)"></button>
                    <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition"
                        onclick="goToSlide(3)"></button>
                    <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition"
                        onclick="goToSlide(4)"></button>
                    <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition"
                        onclick="goToSlide(5)"></button>
                </div>

                <!-- Navigation Arrows -->
                <!-- Navigation Arrows Removed -->


            </div>
        </div>
    </section>
    <!-- Service Icons -->
    <section class="bg-white py-4 mb-4">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-center">
                <div onclick="window.location.href='freeship.html'"
                    class="flex flex-col items-center cursor-pointer hover:scale-110 transition-transform">
                    <i class="fas fa-shipping-fast text-3xl text-red-700 mb-2"></i>
                    <p class="text-sm font-semibold text-gray-700">Free Shipping</p>
                </div>
                <div onclick="window.location.href='vouchers.html'"
                    class="flex flex-col items-center cursor-pointer hover:scale-110 transition-transform">
                    <i class="fas fa-gift text-3xl text-red-700 mb-2"></i>
                    <p class="text-sm font-semibold text-gray-700">Vouchers</p>
                </div>
                <div class="flex flex-col items-center"><i class="fas fa-wallet text-3xl text-red-700 mb-2"></i>
                    <p class="text-sm font-semibold text-gray-700">All Payment</p>
                </div>
                <div class="flex flex-col items-center"><i class="fas fa-percent text-3xl text-red-700 mb-2"></i>
                    <p class="text-sm font-semibold text-gray-700">Great Deals</p>
                </div>
                <div class="flex flex-col items-center"><i class="fas fa-tags text-3xl text-red-700 mb-2"></i>
                    <p class="text-sm font-semibold text-gray-700">Official Brands</p>
                </div>
            </div>
        </div>
    </section>
    <!-- Horizontal Marquee Section (New) -->
    <section class="bg-white py-4 mb-8 overflow-hidden">
        <div class="max-w-[1600px] mx-auto px-0 md:px-4 space-y-4">
            <!-- Row 1: Run Right (->) -->
            <div class="relative flex overflow-hidden group">
                <div class="flex animate-marquee-right whitespace-nowrap">
                    <!-- Images Set 1 (Top Row - 11 Images) -->
                    <div class="flex flex-shrink-0 space-x-4 mx-2">
                        <img src="assets/promo_01.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_02.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_03.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_04.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_05.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_06.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_07.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_01.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_02.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_03.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_04.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                    </div>
                    <!-- Duplicate for Loop -->
                    <div class="flex flex-shrink-0 space-x-4 mx-2">
                        <img src="assets/promo_01.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_02.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_03.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_04.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_05.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_06.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_07.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_01.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_02.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_03.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_04.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                    </div>
                </div>
            </div>
            <!-- Row 2: Run Left (<-) -->
            <div class="relative flex overflow-hidden group">
                <div class="flex animate-marquee-left whitespace-nowrap">
                    <!-- Images Set 2 (Bottom Row - 10 Images) -->
                    <div class="flex flex-shrink-0 space-x-4 mx-2">
                        <img src="assets/promo_row2_01.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_02.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_03.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_04.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_05.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_06.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_05.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_06.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_07.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_08.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                    </div>
                    <!-- Duplicate for Loop -->
                    <div class="flex flex-shrink-0 space-x-4 mx-2">
                        <img src="assets/promo_row2_01.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_02.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_03.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_04.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_05.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_row2_06.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_05.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_06.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_07.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                        <img src="assets/promo_new_08.jpg" class="h-40 w-64 object-cover rounded-lg shadow-md">
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Flash Sale -->
    <section class="bg-white py-6 mb-4">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-4">
                    <h2 class="text-2xl font-bold text-red-600">FLASH
                        SALE</h2>
                    <div class="flex items-center space-x-2" id="flashSaleCountdown"><span
                            class="text-sm font-bold text-gray-500 mr-1">Còn:</span>
                        <div id="flashSaleHours" class="bg-blue-600 text-white px-2 py-1 rounded text-sm font-bold">00
                        </div><span class="text-gray-400">:</span>
                        <div id="flashSaleMinutes" class="bg-blue-600 text-white px-2 py-1 rounded text-sm font-bold">00
                        </div><span class="text-gray-400">:</span>
                        <div id="flashSaleSeconds" class="bg-blue-600 text-white px-2 py-1 rounded text-sm font-bold">00
                        </div>
                    </div>
                </div>
            </div><a href="flash-sale.html" class="text-red-500 font-semibold hover:text-red-600">See All →</a>
        </div>
        <!-- Categories & Flash Sale Products Grid -->
        <div id="flashSaleList" class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-6">
            <!-- Products will be loaded here -->
            <div class="col-span-full text-center text-gray-400 py-8">Loading Flash
                Sale...</div>
        </div>
        </div>
    </section>
    <!-- Categories Section -->
    <section class="bg-white py-6 mb-4">
        <div class="max-w-7xl mx-auto px-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                CATEGORIES</h2>
            <div id="categoryList" class="grid grid-cols-3 md:grid-cols-10 gap-4 text-center">
                <!-- Categories will be loaded here -->
                <div class="col-span-full text-center text-gray-400">Loading Categories...
                </div>
            </div>
        </div>
    </section>
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 pb-12">
        <!-- Daily Discover -->
        <section id="products" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">DAILY DISCOVER</h2><a href="daily-discover.html"
                    class="text-red-500 font-semibold hover:text-red-600">See More</a>
            </div>
            <div id="dailyDiscoverList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                <!-- Products will be loaded here -->
                <div class="col-span-full text-center text-gray-400 py-8">Loading
                    Daily Discover...</div>
            </div>
        </section>
    </main>
    <script> // API Base URL
        const API_BASE_URL = 'http://localhost:8080/api';

        // Load products & categories when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadHomepageProducts();
            loadHomepageCategories();
            loadFlashSaleCountdown();
            setupGlobalSearch();
        });

        let flashSaleCountdownInterval = null;

        async function loadFlashSaleCountdown() {
            const hoursEl = document.getElementById('flashSaleHours');
            const minutesEl = document.getElementById('flashSaleMinutes');
            const secondsEl = document.getElementById('flashSaleSeconds');
            if (!hoursEl || !minutesEl || !secondsEl) return;

            try {
                const res = await fetch(`${API_BASE_URL}/flash-sales/current`);
                if (!res.ok || res.status === 204) {
                    setCountdownText(hoursEl, minutesEl, secondsEl, '--', '--', '--');
                    return;
                }

                const data = await res.json();
                const endTime = data.endTime;

                if (!endTime) {
                    setCountdownText(hoursEl, minutesEl, secondsEl, '--', '--', '--');
                    return;
                }

                // Ensure endTime is treated as UTC (Backend tends to omit 'Z' in some endpoints)
                let dateStr = endTime;
                if (!dateStr.endsWith('Z') && !dateStr.includes('+')) {
                    dateStr += 'Z';
                }
                const end = new Date(dateStr);

                function tick() {
                    const now = new Date();
                    let ms = end - now;

                    if (ms <= 0) {
                        setCountdownText(hoursEl, minutesEl, secondsEl, '00', '00', '00');
                        if (flashSaleCountdownInterval) clearInterval(flashSaleCountdownInterval);
                        return;
                    }

                    const s = Math.floor((ms / 1000) % 60);
                    const m = Math.floor((ms / 60000) % 60);
                    const h = Math.floor(ms / 3600000);
                    setCountdownText(hoursEl, minutesEl, secondsEl,
                        String(h).padStart(2, '0'),
                        String(m).padStart(2, '0'),
                        String(s).padStart(2, '0'));
                }

                tick();
                if (flashSaleCountdownInterval) clearInterval(flashSaleCountdownInterval);
                flashSaleCountdownInterval = setInterval(tick, 1000);
            }

            catch (e) {
                console.error('Flash sale countdown error:', e);
                setCountdownText(hoursEl, minutesEl, secondsEl, '--', '--', '--');
            }
        }

        function setCountdownText(hEl, mEl, sEl, h, m, s) {
            if (hEl) hEl.textContent = h;
            if (mEl) mEl.textContent = m;
            if (sEl) sEl.textContent = s;
        }

        // Global header search: redirect to search results page (category.html) with keyword
        function setupGlobalSearch() {
            const searchInput = document.getElementById('globalSearchInput');
            const searchButton = document.getElementById('globalSearchButton');
            if (!searchInput || !searchButton) return;

            const redirectToSearchPage = () => {
                const keyword = searchInput.value.trim();
                if (!keyword) return;
                const encoded = encodeURIComponent(keyword);

                window.location.href = `category.html?search=${encoded}`;
            }

                ;

            searchButton.addEventListener('click', redirectToSearchPage);

            searchInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    redirectToSearchPage();
                }
            });
        }

        async function loadHomepageCategories() {
            try {
                const response = await fetch(`${API_BASE_URL}/categories`);
                if (!response.ok) throw new Error('Failed to fetch categories');

                const categories = await response.json();
                const container = document.getElementById('categoryList');
                container.innerHTML = ''; // Clear loading

                // Icon Mapping Helper
                const getIcon = (name) => {
                    const lowerName = name.toLowerCase();
                    if (lowerName.includes('fashion') || lowerName.includes('shirt') || lowerName.includes('cloth')) return 'fa-tshirt';
                    if (lowerName.includes('electronic') || lowerName.includes('laptop') || lowerName.includes('tech')) return 'fa-laptop';
                    if (lowerName.includes('mobile') || lowerName.includes('phone')) return 'fa-mobile-alt';
                    if (lowerName.includes('home') || lowerName.includes('house')) return 'fa-home';
                    if (lowerName.includes('beauty') || lowerName.includes('skin') || lowerName.includes('face')) return 'fa-heart';
                    if (lowerName.includes('baby') || lowerName.includes('toy') || lowerName.includes('kid')) return 'fa-baby';
                    if (lowerName.includes('sport') || lowerName.includes('gym')) return 'fa-dumbbell';
                    if (lowerName.includes('food') || lowerName.includes('cook')) return 'fa-utensils';
                    if (lowerName.includes('book') || lowerName.includes('read')) return 'fa-book';
                    if (lowerName.includes('shoe') || lowerName.includes('sneaker')) return 'fa-shoe-prints';
                    if (lowerName.includes('watch')) return 'fa-clock';
                    return 'fa-tags'; // Default
                }

                    ;

                categories.forEach(category => {
                    // DEBUG: Log raw category object
                    console.log('🔍 Raw category object:', category);

                    // Map "House" or "Furniture" to "Home" if needed for consistency with User's UI
                    let displayName = category.name;
                    if (displayName && displayName.toLowerCase() === 'house') displayName = 'Home';

                    // Safe ID Resolution
                    const catId = category.id || category._id;

                    console.log(`🔍 Category "${displayName}" - ID: ${catId}`);

                    if (!catId) {
                        console.error('❌ Missing ID for category:', category);
                        return;
                    }

                    const iconClass = getIcon(displayName || 'Category');

                    // Revert to DIV + OnClick (User Requirement)
                    const div = document.createElement('div');
                    div.className = 'flex flex-col items-center cursor-pointer hover:text-red-700 transition group';

                    div.onclick = function () {
                        // CRITICAL: Validate catId before navigation
                        console.log('🔥 CATEGORY CLICKED!');
                        console.log('🔥 catId:', catId);
                        console.log('🔥 displayName:', displayName);
                        console.log('🔥 category object:', category);

                        if (!catId || catId === 'undefined' || catId === 'null' || catId.trim() === '') {
                            console.error('❌ Invalid Category ID for:', displayName);
                            console.error('❌ catId value:', catId);
                            console.error('❌ Full category object:', category);
                            alert(`Error: Cannot navigate - Category ID is invalid for "${displayName}" `);
                            return;
                        }

                        // DEBUG: Log navigation details
                        // Use hash-based navigation to bypass server routing issues
                        const targetUrl = `category.html#id=${catId}&name=${encodeURIComponent(displayName || 'Category')}`;

                        const absoluteUrl = `${window.location.origin}/${targetUrl}`;

                        console.log(`🔗 TARGET URL (HASH): ${targetUrl}`);

                        console.log(`🔗 ABSOLUTE URL: ${absoluteUrl}`);

                        console.log(` Category: ${displayName}`);

                        console.log(` ID: ${catId}`);

                        // Use hash-based URL to bypass server routing
                        window.location.href = absoluteUrl;
                    };

                    div.innerHTML = ` <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-2 group-hover:bg-red-200 transition" > <i class="fas ${iconClass} text-2xl text-red-700" ></i> </div> <p class="text-xs font-medium text-center line-clamp-2 px-1 text-gray-700 group-hover:text-red-700" >${displayName || 'Category'}</p> `;
                    container.appendChild(div);
                });

                // Add "More" button if needed, or just let users scroll/see all
                // For layout balance, if not divisible by 10, maybe we don't care.

            }

            catch (error) {
                console.error('Error loading categories:', error);
                document.getElementById('categoryList').innerHTML = '<div class="col-span-full text-center text-red-500">Error loading categories.</div>';
            }
        }

        async function loadHomepageProducts() {
            try {

                // 1. Load Flash Sale Products
                const curFsResp = await fetch(`${API_BASE_URL}/flash-sales/current`);
                if (curFsResp.ok && curFsResp.status !== 204) {
                    const currentFs = await curFsResp.json();
                    if (currentFs && currentFs.id) {
                        const itemsResp = await fetch(`${API_BASE_URL}/flash-sales/${currentFs.id}/items`);
                        if (itemsResp.ok) {
                            const fsItems = await itemsResp.json();
                            if (fsItems.length > 0) {
                                renderProductList(fsItems.slice(0, 6), 'flashSaleList', true);
                            } else {
                                document.getElementById('flashSaleList').innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No items in this flash sale.</div>';
                            }
                        }
                    }
                } else {
                    document.getElementById('flashSaleList').innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No flash sale active.</div>';
                }

                // 2. Load All Products for Daily Discover
                const response = await fetch(`${API_BASE_URL}/products`);
                if (!response.ok) throw new Error('Failed to fetch products');

                const products = await response.json();

                if (products.length === 0) {
                    document.getElementById('dailyDiscoverList').innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No products available yet.</div>';
                    return;
                }

                // SORT LOGIC: Show NEWEST 6 products in Daily Discover
                const sortedProducts = [...products].sort((a, b) => {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                });

                renderProductList(sortedProducts.slice(0, 6), 'dailyDiscoverList', false);

            }

            catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('flashSaleList').innerHTML = '<div class="col-span-full text-center text-red-500 py-8">Error loading products.</div>';
                document.getElementById('dailyDiscoverList').innerHTML = '<div class="col-span-full text-center text-red-500 py-8">Error loading products.</div>';
            }
        }

        function renderProductList(products, containerId, isFlashSale) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            products.forEach(product => {
                // Determine Info Mapping (Standard Product vs FlashSaleItemResponse)
                let imageUrl = 'https://via.placeholder.com/400x400?text=No+Image';
                let productName = product.name || 'Product';
                let priceDisplay = 'Contact';
                // FIX: Prioritize productId (for FlashSaleItem) over id (FlashSaleItem ID)
                // If it's a normal Product, id is the Product ID.
                // If it's a FlashSaleItemResponse, productId is the Product ID, and id is the Item ID.
                let pid = product.productId || product.id || product._id;
                let soldCount = product.sold != null ? product.sold : 0;
                let rating = product.rating != null ? product.rating.toFixed(1) : '-';

                if (isFlashSale) {
                    // product is FlashSaleItemResponse
                    imageUrl = product.productImage || imageUrl;
                    productName = product.productName || productName;
                    priceDisplay = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.salePrice);
                    soldCount = (product.saleStock || 0) - (product.remainingStock || 0);
                } else {
                    // product is standard Product
                    if (product.images && product.images.length > 0) imageUrl = product.images[0];
                    if (product.isFlashSale && product.flashSalePrice > 0) {
                        priceDisplay = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.flashSalePrice);
                    } else if (product.variants && product.variants.length > 0) {
                        priceDisplay = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(product.variants[0].price);
                    }
                }

                // Badge Logic
                let badgeHtml = '';

                if (isFlashSale) {
                    badgeHtml = `<div class="absolute top-2 left-2 bg-yellow-400 text-black px-2 py-1 rounded text-xs font-bold"><i class="fas fa-bolt mr-1"></i>SALE</div>`;
                } else {
                    // Random badge for Daily Discover (Red Theme)
                    const badges = ['NEW', 'HOT', 'SALE', 'BEST'];
                    const randomBadge = badges[Math.floor(Math.random() * badges.length)];

                    badgeHtml = `<div class="absolute top-2 left-2 bg-red-600 text-white px-2 py-1 rounded text-xs font-bold" >${randomBadge}</div>`;
                }

                // Progress Bar for Flash Sale (Pro refinement)
                let progressBarHtml = '';

                if (isFlashSale) {
                    const total = product.saleStock || 10;
                    const remaining = product.remainingStock || 0;
                    const sold = total - remaining;
                    const progressPercent = Math.max(10, Math.floor((sold / total) * 100)); // Minimum 10% for better visibility
                    const isHot = progressPercent > 80;

                    progressBarHtml = `
                        <div class="mt-2">
                             <div class="relative w-full bg-red-100 h-5 rounded-full overflow-hidden border border-red-200">
                                <div class="bg-gradient-to-r from-red-500 to-red-800 h-full rounded-full transition-all duration-1000 flex items-center justify-end pr-2 shadow-inner" style="width: ${progressPercent}%">
                                     ${isHot ? '<i class="fas fa-fire text-white text-[10px] animate-pulse"></i>' : ''}
                                </div>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-[10px] font-bold text-white uppercase tracking-tighter shadow-sm text-shadow">
                                        ${remaining === 0 ? 'HẾT HÀNG' : `ĐÃ BÁN ${sold}`}
                                    </span>
                                </div>
                            </div>
                            ${isHot ? '<p class="text-[10px] text-red-600 font-bold mt-1 animate-bounce text-center"><i class="fas fa-fire mr-1"></i>SẮP CHÁY HÀNG</p>' : ''}
                        </div>`;
                } else {
                    progressBarHtml = `
                        <div class="flex items-center text-xs text-gray-500 mt-1">
                            <i class="fas fa-star text-yellow-400"></i>
                            <span class="ml-1">${rating}</span>
                            <span class="ml-2 border-l border-gray-300 pl-2">Đã bán ${soldCount}</span>
                        </div>`;
                }

                const productCard = document.createElement('div');
                productCard.className = 'bg-white rounded-lg shadow hover:shadow-lg transition-all overflow-hidden group cursor-pointer';

                productCard.onclick = () => {
                    if (pid) {
                        localStorage.setItem('lastClickedProductId', pid);
                        sessionStorage.setItem('lastClickedProductId', pid);

                        window.location.href = `product-detail.html?id=${pid}`;
                    }
                }

                productCard.innerHTML = `
                    <div class="relative">
                        <img src="${imageUrl}" alt="${productName}" class="w-full h-48 object-cover">
                        ${badgeHtml}
                    </div>
                    <div class="p-3">
                        <p class="text-sm text-gray-700 mb-2 h-10 line-clamp-2">${productName}</p>
                        <p class="text-red-600 text-lg font-bold">${priceDisplay}</p>
                        ${progressBarHtml}
                    </div>
                `;
                container.appendChild(productCard);
            });
        }

        function goToProduct(id) {
            localStorage.setItem('lastClickedProductId', id);
            sessionStorage.setItem('lastClickedProductId', id);

            window.location.href = `product-detail.html?id=${id}`;
        }

    </script>
    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-16">
        <div class="max-w-7xl mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">CUSTOMER SERVICE</h3>
                    <ul class="space-y-2 text-gray-400 text-sm">
                        <li><a href="#" class="hover:text-white transition-colors">Help
                                Center</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">How
                                To Buy</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Shipping</a>
                        </li>
                        <li><a href="#" class="hover:text-white transition-colors">Returns</a>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">ABOUT GOSHOP</h3>
                    <ul class="space-y-2 text-gray-400 text-sm">
                        <li><a href="#" class="hover:text-white transition-colors">About
                                Us</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Careers</a>
                        </li>
                        <li><a href="#" class="hover:text-white transition-colors">Privacy
                                Policy</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Terms</a>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">PAYMENT</h3>
                    <div class="grid grid-cols-4 gap-2">
                        <div class="bg-white rounded p-2"><i class="fab fa-cc-visa text-2xl text-blue-600"></i></div>
                        <div class="bg-white rounded p-2"><i class="fab fa-cc-mastercard text-2xl text-red-600"></i>
                        </div>
                        <div class="bg-white rounded p-2"><i class="fab fa-cc-paypal text-2xl text-blue-400"></i>
                        </div>
                        <div class="bg-white rounded p-2"><i class="fas fa-credit-card text-2xl text-gray-600"></i>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">FOLLOW US</h3>
                    <div class="flex space-x-4 mb-4"><a href="#" class="text-2xl hover:text-red-500 transition"><i
                                class="fab fa-facebook"></i></a><a href="#"
                            class="text-2xl hover:text-red-500 transition"><i class="fab fa-instagram"></i></a><a
                            href="#" class="text-2xl hover:text-red-500 transition"><i class="fab fa-youtube"></i></a><a
                            href="#" class="text-2xl hover:text-red-500 transition"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400 text-sm">
                <p>&copy;
                    2026 GoShop. All rights reserved.</p>
            </div>
        </div>
    </footer>
    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-md w-full max-h-[80vh] overflow-y-auto shadow-2xl">
            <div class="p-6 border-b">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center"><i
                        class="fas fa-shopping-cart mr-3 text-red-500"></i>Your
                    Cart </h2>
            </div>
            <div id="cartItems" class="p-6">
                <p class="text-gray-500 text-center py-8">Cart is empty</p>
            </div>
            <div class="p-6 border-t bg-gray-50 rounded-b-3xl">
                <div class="flex justify-between text-xl font-bold mb-4">
                    <span>Total:</span><span id="cartTotal" class="text-red-500">0đ</span>
                </div><button onclick="checkout()"
                    class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-4 rounded-2xl font-bold text-lg shadow-xl transform hover:-translate-y-1 transition-all">Checkout
                    Now </button>
            </div>
        </div>
    </div>
    <script>

        /* ===============================
           1️⃣ GOOGLE CALLBACK (NẾU CÓ)
        ================================ */
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const token = params.get('token');
            const userName = params.get('userName');
            const error = params.get('error');

            if (error) {
                console.error('❌ Google login error:', error);
                return;
            }

            if (token && userName) {
                localStorage.setItem('accessToken', token);
                localStorage.setItem('userName', decodeURIComponent(userName));

                window.history.replaceState({}

                    , document.title, window.location.pathname);
            }

            updateNavbar();
            updateCartBadge();
        });

        async function updateCartBadge() {
            // HIDE IF NOT LOGGED IN
            const token = localStorage.getItem('accessToken');

            if (!token) {
                const badge = document.getElementById('cartBadge');
                if (badge) badge.style.display = 'none';
                return;
            }

            try {
                const response = await fetch('http://localhost:8080/api/cart', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const cartData = await response.json();
                    // Calculate total items from backend response
                    const totalItems = cartData.items ? cartData.items.reduce((sum, item) => sum + item.quantity, 0) : 0;

                    const badge = document.getElementById('cartBadge');

                    if (badge) {
                        badge.textContent = totalItems;
                        badge.style.display = totalItems > 0 ? 'inline-block' : 'none';
                    }
                }
            }

            catch (error) {
                console.error('Failed to update cart badge:', error);
            }
        }

        /* ===============================
           2️⃣ UPDATE NAVBAR (CỐT LÕI)
        ================================ */
        /* ===============================
           2️⃣ UPDATE NAVBAR (CỐT LÕI)
        ================================ */
        /* ===============================
           2️⃣ UPDATE NAVBAR (CỐT LÕI)
        ================================ */
        async function updateNavbar() {
            const token = localStorage.getItem('accessToken');
            const userName = localStorage.getItem('userName') || 'User';

            const guestNav = document.getElementById('guestNav');
            const userNav = document.getElementById('userNav');
            const userNameEl = document.getElementById('userName');
            const userAvatar = document.getElementById('userAvatar');
            const sellerLink = document.getElementById('sellerChannelLink');
            const adminLink = document.getElementById('adminPanelLink');

            if (token) {
                guestNav.classList.add('hidden');
                userNav.classList.remove('hidden');
                userNameEl.textContent = userName;

                if (userAvatar) {
                    userAvatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=fecaca&color=AD3029`;
                }

                // CHECK SHOP STATUS
                await checkShopStatus(token, sellerLink);

                // CHECK ADMIN ROLE
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    const roles = payload.roles || [];
                    let isAdmin = false;

                    if (Array.isArray(roles)) {
                        isAdmin = roles.some(r => r === "ROLE_ADMIN" || r.name === "ROLE_ADMIN" || r.authority === "ROLE_ADMIN");
                    }

                    if (isAdmin && adminLink) {
                        adminLink.classList.remove('hidden');
                    }
                }

                catch (e) {
                    console.error("Error parsing token roles", e);
                }

            }

            else {
                guestNav.classList.remove('hidden');
                userNav.classList.add('hidden');
                if (sellerLink) sellerLink.classList.add('hidden');
                if (adminLink) adminLink.classList.add('hidden');
            }
        }

        async function checkShopStatus(token, linkElement) {
            if (!linkElement) return;

            try {
                const response = await fetch('http://localhost:8080/api/shop/my-shop', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    // User has a shop -> Go to Dashboard
                    linkElement.href = "seller-dashboard.html";
                    linkElement.innerHTML = '<i class="fas fa-store mr-1"></i>My Shop';
                    linkElement.classList.remove('hidden');
                }

                else if (response.status === 404) {
                    // User has NO shop -> Go to Register
                    linkElement.href = "seller-register.html";
                    linkElement.innerHTML = 'Seller Register';
                    linkElement.classList.remove('hidden');
                }
            }

            catch (err) {
                console.error("Failed to check shop status", err);
                // Default fallback
                linkElement.href = "seller-register.html";
                linkElement.classList.remove('hidden');
            }
        }

        /* ===============================
           3️⃣ LOGOUT
        ================================ */
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('accessToken');
                localStorage.removeItem('userName');
                localStorage.removeItem('user');
                localStorage.removeItem('userRole');
                localStorage.removeItem('userId');
                localStorage.removeItem('refreshToken');

                // Toggle Authenticated UI via updateNavbar
                updateNavbar();
                updateCartBadge();
                window.location.href = 'index.html';
            }
        }

        /* ===============================
           4️⃣ BANNER SLIDER
        ================================ */
        /* ===============================
           4️⃣ DUAL VERTICAL SLIDER (Final Fixed)
        ================================ */
        // Configuration
        // Left: MARQUEE (Handled by CSS)
        // Right: 0(Clone Last) + 1..16(Real) + 17(Clone First) = 18 total

        // State
        let rightIndex = 1; // Start at 1 (First Real Slide)

        function slideLoop() {
            const rightEl = document.getElementById('sliderRight');

            // --- RIGHT SLIDER (UPWARD/FORWARD) ---
            if (rightEl) {
                rightIndex++; // Move down the list (Image moves UP)
                rightEl.style.transition = "transform 1000ms ease-in-out";
                rightEl.style.transform = `translateY(-${rightIndex * 100}%)`;
            }

            // CHECK RESET (After transition ends - 1000ms)
            setTimeout(() => {
                // Reset Right
                if (rightEl && rightIndex >= 17) {
                    // 17 is Clone of 1
                    rightEl.style.transition = "none";
                    rightIndex = 1; // Jump back to Real 1
                    rightEl.style.transform = `translateY(-${rightIndex * 100}%)`;
                }
            }, 1000);
        }

        // Initialize Slider
        document.addEventListener('DOMContentLoaded', () => {
            const rightEl = document.getElementById('sliderRight');

            // Set initial position
            if (rightEl) rightEl.style.transform = `translateY(-${rightIndex * 100}%)`;

            // Start Loop
            setInterval(slideLoop, 3000);
        });

        /* ===============================
           4️⃣ CART (GIỮ NGUYÊN)
        ================================ */
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        function addToCart(productName) {

            // AUTH GUARD
            if (!localStorage.getItem('accessToken')) {
                if (confirm('⚠️ You must login to buy items! Go to login?')) {
                    window.location.href = 'login.html';
                }

                return;
            }

            const existing = cart.find(item => item.name === productName);
            if (existing) existing.quantity += 1;

            else cart.push({
                name: productName, quantity: 1, price: 1000000
            });

            localStorage.setItem('cart', JSON.stringify(cart));
            alert('✅ Added to cart!');
            updateCartBadge();
        }

        function showCart() {
            window.location.href = 'cart-backend.html';
        }

        function goToProduct(id) {
            console.log('Navigating to product:', id);
            localStorage.setItem('lastClickedProductId', id);
            sessionStorage.setItem('lastClickedProductId', id);

            window.location.href = `product-detail.html?id=${id}`;
        }
        function checkout() {
            alert('✅ Order placed successfully!');
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            document.getElementById('cartModal').classList.add('hidden');
        }

    </script>
    <script>
        // --- AUTH & NAVBAR LOGIC ---
        async function updateNavbar() {
            const token = localStorage.getItem('accessToken');
            const user = JSON.parse(localStorage.getItem('user') || '{}'); // Try to get full user object
            const userName = user.fullName || localStorage.getItem('userName') || 'User';
            const userRole = user.role || localStorage.getItem('userRole') || 'CUSTOMER';

            const guestNav = document.getElementById('guestNav');
            const userNav = document.getElementById('userNav');
            const userNameEl = document.getElementById('userName');
            const userAvatar = document.getElementById('userAvatar');
            const adminPanelLink = document.getElementById('adminPanelLink');
            const sellerChannelLink = document.getElementById('sellerChannelLink');

            if (token) {
                // LOGGED IN
                if (guestNav) guestNav.classList.add('hidden');
                if (userNav) userNav.classList.remove('hidden');
                if (userNav) userNav.style.display = 'flex';

                if (userNameEl) userNameEl.textContent = userName;
                if (userAvatar) {
                    userAvatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=fecaca&color=AD3029`;
                }

                // CHECK SHOP STATUS (Restored)
                // This will toggle between "My Shop" and "Seller Register" based on API
                if (typeof checkShopStatus === 'function') {
                    await checkShopStatus(token, sellerChannelLink);
                }

                // Check Roles (Admin)
                if (userRole === 'ADMIN' && adminPanelLink) adminPanelLink.classList.remove('hidden');

            } else {
                // NOT LOGGED IN
                if (guestNav) guestNav.classList.remove('hidden');
                if (userNav) userNav.classList.add('hidden');
                if (userNav) userNav.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateNavbar();
            updateCartBadge(); // Ensure cart badge is also updated

            // Listen for changes in other tabs/windows
            window.addEventListener('storage', (e) => {
                if (e.key === 'user' || e.key === 'userName' || e.key === 'accessToken') {
                    console.log('🔄 Storage changed, updating navbar...');
                    updateNavbar();
                    updateCartBadge();
                }
            });
        });
    </script>
    <script src="js/notification.js"></script>

    <!--    <!-- Scripts -->
    <script>
        const slidesContainer = document.getElementById('carouselSlides');
        const totalSlides = 6; // Updated to 6 slides
        let currentSlide = 0;
        let slideInterval;

        function showSlide(index) {
            if (index >= totalSlides) currentSlide = 0;
            else if (index < 0) currentSlide = totalSlides - 1;
            else currentSlide = index;

            slidesContainer.style.transform = `translateX(-${currentSlide * 100}%)`;

            // Update dots
            document.querySelectorAll('#heroCarousel button.w-3').forEach((dot, idx) => {
                if (idx === currentSlide) {
                    dot.classList.remove('bg-white/50');
                    dot.classList.add('bg-white', 'scale-125');
                } else {
                    dot.classList.add('bg-white/50');
                    dot.classList.remove('bg-white', 'scale-125');
                }
            });
        }

        function moveSlide(step) {
            showSlide(currentSlide + step);
            resetTimer();
        }

        function goToSlide(index) {
            showSlide(index);
            resetTimer();
        }

        function startTimer() {
            slideInterval = setInterval(() => {
                moveSlide(1);
            }, 5000); // 5 seconds
        }

        function resetTimer() {
            clearInterval(slideInterval);
            startTimer();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            showSlide(0);
            startTimer();
        });
    </script>
</body>

</html>